<!doctype html>
<html>
    <head>
        <style>
            body {
                background-color: black;
            }
        </style>
    </head>
    <body>
        <div id="funkyFeed"></div>
        <script>
            var funkyFeed = document.getElementById("funkyFeed");
            var funkyPosts = [];

            //FLINES POSTS
            fetch("https://raflines.github.io/scripts/rss.xml")
                .then((response) => {
                    return response.text();
                })
                .then((xmlString) => {
                    const xmlDocument = new DOMParser().parseFromString(
                        xmlString,
                        "text/xml",
                    );

                    //HEADER
                    var channel =
                        xmlDocument.getElementsByTagName("channel")[0];

                    var title = channel.getElementsByTagName("title")[0];
                    var link = channel.getElementsByTagName("link")[0];
                    var description =
                        channel.getElementsByTagName("description")[0];
                    var language =
                        channel.getElementsByTagName("description")[0];

                    //POSTS
                    var items = channel.getElementsByTagName("item");
                    for (let i = 0; i < items.length; i++) {
                        var title = items[i].getElementsByTagName("title")[0];
                        var link = items[i].getElementsByTagName("link")[0];
                        var description =
                            items[i].getElementsByTagName("description")[0];
                        var pubdate =
                            items[i].getElementsByTagName("pubDate")[0];

                        // Remove the "th", "st", "nd", "rd" from the day so JS can parse it
                        const cleaned = pubdate.textContent.replace(
                            /(\d+)(st|nd|rd|th)/,
                            "$1",
                        );

                        const date = new Date(cleaned);

                        // Get individual parts
                        const day = String(date.getDate()).padStart(2, "0");
                        const month = String(date.getMonth() + 1).padStart(
                            2,
                            "0",
                        );
                        const year = String(date.getFullYear()).slice(-2);
                        const hours = String(date.getHours()).padStart(2, "0");
                        const minutes = String(date.getMinutes()).padStart(
                            2,
                            "0",
                        );

                        // Build formatted string
                        const formatted = `${hours}:${minutes}, ${day}/${month}/${year}`;

                        var postTitle =
                            '<b><font face="Times New Roman" size="6" style="color: white;">' +
                            title.textContent +
                            "</font></b><br>";
                        var postDescription = description.textContent
                            .replace(
                                /(0?[1-9]|[12][0-9]|3[01])[\/\-\.](0?[1-9]|1[012])[\/\-\.]\d{4}/,
                                "",
                            )
                            .replace("[]>", "")
                            .replace(
                                "<p>",
                                '<b><font face="Times New Roman" size="3" style="color: white; text-align: justify;">',
                            )
                            .replace("</p>", "</font></b>")
                            .replace(
                                "<img",
                                "</div><img style='border: 2px solid #FFFFFF; max-width: 500px;' ",
                            );
                        var postAuthorTime =
                            '<p><center><b><font face="Times New Roman" size="3" style="color: white;">Posted by <a class="nav_btn" href="https://raflines.github.io"><img src="/assets/favicon-16x16.png" style="vertical-align: middle;"/> FLINES</a> at ' +
                            formatted +
                            "</font></b></center></p>";

                        funkyPosts.push([
                            "<div>" +
                                postTitle +
                                "</div><br><div style='text-align: justify;'>" +
                                postDescription +
                                postAuthorTime +
                                "</div>" +
                                '<hr class="solid" style="width: 31.25%; color: white; margin-top: 32px; margin-bottom: 64px;">',
                            date,
                        ]);
                    }

                    //FARAWAY POSTS
                    fetch("https://farawaydrip30.github.io/rss.xml")
                        .then((response) => {
                            return response.text();
                        })
                        .then((xmlString) => {
                            const xmlDocument = new DOMParser().parseFromString(
                                xmlString,
                                "text/xml",
                            );

                            //HEADER
                            var channel =
                                xmlDocument.getElementsByTagName("channel")[0];

                            var title =
                                channel.getElementsByTagName("title")[0];
                            var link = channel.getElementsByTagName("link")[0];
                            var description =
                                channel.getElementsByTagName("description")[0];
                            var language =
                                channel.getElementsByTagName("description")[0];

                            //POSTS
                            var items = channel.getElementsByTagName("item");
                            for (let i = 0; i < items.length; i++) {
                                var title =
                                    items[i].getElementsByTagName("title")[0];
                                var link =
                                    items[i].getElementsByTagName("link")[0];
                                var description =
                                    items[i].getElementsByTagName(
                                        "description",
                                    )[0];
                                var pubdate =
                                    items[i].getElementsByTagName("pubDate")[0];

                                // Remove the "th", "st", "nd", "rd" from the day so JS can parse it
                                const cleaned = pubdate.textContent.replace(
                                    /(\d+)(st|nd|rd|th)/,
                                    "$1",
                                );

                                const date = new Date(cleaned);

                                // Get individual parts
                                const day = String(date.getDate()).padStart(
                                    2,
                                    "0",
                                );
                                const month = String(
                                    date.getMonth() + 1,
                                ).padStart(2, "0");
                                const year = String(date.getFullYear()).slice(
                                    -2,
                                );
                                const hours = String(date.getHours()).padStart(
                                    2,
                                    "0",
                                );
                                const minutes = String(
                                    date.getMinutes(),
                                ).padStart(2, "0");

                                // Build formatted string
                                const formatted = `${hours}:${minutes}, ${day}/${month}/${year}`;

                                var postTitle =
                                    '<b><font face="Times New Roman" size="6" style="color: white;">' +
                                    title.textContent +
                                    "</font></b><br>";
                                var postDescription = description.textContent
                                    .replace(
                                        /(0?[1-9]|[12][0-9]|3[01])[\/\-\.](0?[1-9]|1[012])[\/\-\.]\d{4}/,
                                        "",
                                    )
                                    .replace("[]>", "")
                                    .replace(
                                        "<p>",
                                        '<b><font face="Times New Roman" size="3" style="color: white; text-align: justify;">',
                                    )
                                    .replace("</p>", "</font></b>")
                                    .replace(
                                        "<img",
                                        "</div><img style='border: 2px solid #FFFFFF; max-width: 500px;' ",
                                    );
                                var postAuthorTime =
                                    '<p><center><b><font face="Times New Roman" size="3" style="color: white;">Posted by <a class="nav_btn" href="https://farawaydrip30.github.io"><img src="https://farawaydrip30.github.io/favicon.ico" style="width: 16px; vertical-align: middle;"/> FarawayDrip30</a> at ' +
                                    formatted +
                                    "</font></b></center></p>";

                                funkyPosts.push([
                                    "<div>" +
                                        postTitle +
                                        "</div><br><div style='text-align: justify;'>" +
                                        postDescription +
                                        postAuthorTime +
                                        "</div>" +
                                        '<hr class="solid" style="width: 31.25%; color: white; margin-top: 32px; margin-bottom: 64px;">',
                                    date,
                                ]);
                            }

                            updateFeed();
                        });
                });

            function updateFeed() {
                funkyPosts.sort(function (a, b) {
                    // Turn your strings into dates, and then subtract them
                    // to get a value that is either negative, positive, or zero.
                    return new Date(b[1]) - new Date(a[1]);
                });

                for (let i = 0; i < funkyPosts.length; i++) {
                    funkyFeed.innerHTML += funkyPosts[i][0];
                }
            }
        </script>
    </body>
</html>
